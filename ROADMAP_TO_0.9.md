# ğŸ¯ 0.9ì  ë‹¬ì„± ë¡œë“œë§µ

## í˜„ì¬ ìƒí™©
- **í˜„ì¬ ìµœê³  ì ìˆ˜**: 0.63 (super_simple_submission.csv)
- **ëª©í‘œ ì ìˆ˜**: 0.9
- **í•„ìš”í•œ í–¥ìƒ**: +0.27 (43% ì„±ëŠ¥ í–¥ìƒ)

---

## ğŸ“Š ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ë¶„ì„ ê²°ê³¼

### ë°œê²¬ëœ ë¬¸ì œì 

| ë¬¸ì œ ìœ í˜• | ê°œìˆ˜ | BM25 Score | ì‹¬ê°ë„ |
|----------|------|------------|--------|
| **Context-Dependent** (ë©€í‹°í„´) | 3ê°œ | 7.25~8.47 | ğŸ”´ HIGH |
| **Abstract** (ì¶”ìƒì  í‘œí˜„) | 3ê°œ | 7.55~9.32 | ğŸŸ¡ MEDIUM |
| **Specific Entity** (ê³ ìœ ëª…ì‚¬) | 1ê°œ | 8.15 | ğŸŸ¡ MEDIUM |
| **Other** (ì˜ì–´ í‚¤ì›Œë“œ) | 2ê°œ | 8.34 | ğŸŸ¡ MEDIUM |

**ì´ 9ê°œ ì¿¼ë¦¬**ê°€ BM25 ì ìˆ˜ 10.0 ë¯¸ë§Œìœ¼ë¡œ ë‚®ì€ ê²€ìƒ‰ ì„±ëŠ¥

---

## ğŸš€ 3ë‹¨ê³„ ê°œì„  ì „ëµ

### Phase 1: Context-Aware Search (ì˜ˆìƒ +0.15) ğŸ”´ ìµœìš°ì„ 

**ë¬¸ì œ**:
```
ì´ì „ ëŒ€í™”: "ë‹¬ì„ ë³´ë©´ í•­ìƒ ê°™ì€ ë©´ë§Œ ë³´ì´ë”ë¼êµ¬"
í˜„ì¬ ì¿¼ë¦¬: "ê·¸ ì´ìœ ê°€ ë­ì•¼?"  â† ëŒ€ëª…ì‚¬ ì‚¬ìš©, ë§¥ë½ ì˜ì¡´ì 
â†’ BM25 ê²€ìƒ‰ ì‹¤íŒ¨ (max_score: 7.25)
```

**í•´ê²°ì±…**:
```python
# LLMìœ¼ë¡œ ì¿¼ë¦¬ ì¬ì‘ì„±
ì´ì „ ë§¥ë½ + í˜„ì¬ ì¿¼ë¦¬ â†’ "ë‹¬ì´ í•­ìƒ ê°™ì€ ë©´ë§Œ ë³´ì´ëŠ” ì´ìœ ëŠ”?"
```

**êµ¬í˜„**:
```bash
python3 rag_with_context.py
# ì¶œë ¥: context_aware_submission.csv
```

**ì˜í–¥ë°›ëŠ” ì¿¼ë¦¬**:
- ID 43: "ê·¸ ì´ìœ ê°€ ë­ì•¼?" (ë‹¬ ê´€ë ¨)
- ID 44: "ê·¸ ì´ìœ ê°€ ë­ì•¼?" (ë…ê° ê´€ë ¨)
- ID 97: "ê·¸ëŸ¼ ìˆœê¸°ëŠ¥ì— ëŒ€í•´ ì•Œë ¤ì¤„ë˜?" (ì„¸ê·  ê´€ë ¨)

**ì˜ˆìƒ íš¨ê³¼**:
- 3ê°œ ì¿¼ë¦¬ì˜ APê°€ 0.0 â†’ 0.8ë¡œ í–¥ìƒ
- ì „ì²´ MAP +0.10~0.15 í–¥ìƒ

---

### Phase 2: Query Expansion (ì˜ˆìƒ +0.05) ğŸŸ¡

**ë¬¸ì œ**:
```
Query: "interferonì˜ ì—­í• ì— ëŒ€í•´ ì•Œë ¤ì¤˜"
â†’ ì˜ì–´ í‚¤ì›Œë“œ "interferon"ë§Œìœ¼ë¡œ ê²€ìƒ‰
â†’ í•œê¸€ ë¬¸ì„œ "ì¸í„°í˜ë¡ "ê³¼ ë§¤ì¹­ ì‹¤íŒ¨
```

**í•´ê²°ì±…**:
```python
# 1. ì˜ì–´ â†’ í•œê¸€ ë³€í™˜
"interferon" â†’ "ì¸í„°í˜ë¡ "

# 2. ë™ì˜ì–´ í™•ì¥
"ì—­í• " â†’ "ê¸°ëŠ¥", "ì‘ìš©", "íš¨ê³¼"

# 3. í™•ì¥ëœ ì¿¼ë¦¬ë¡œ ê²€ìƒ‰
"ì¸í„°í˜ë¡  OR interferon AND (ì—­í•  OR ê¸°ëŠ¥ OR ì‘ìš©)"
```

**ì˜í–¥ë°›ëŠ” ì¿¼ë¦¬**:
- ID 55: "interferonì˜ ì—­í• ì— ëŒ€í•´ ì•Œë ¤ì¤˜"
- ID 209: "bridge inverterì˜ ì—­í• ì— ëŒ€í•´ ì•Œë ¤ì¤˜"
- ID 280: "Dmitri Ivanovskyê°€ ëˆ„êµ¬ì•¼?" (ê³ ìœ ëª…ì‚¬)

**ì˜ˆìƒ íš¨ê³¼**: MAP +0.03~0.05

---

### Phase 3: Hybrid Search ê³ ë„í™” (ì˜ˆìƒ +0.05~0.07) ğŸŸ¢

**ë¬¸ì œ**:
- í˜„ì¬ BM25ë§Œ ì‚¬ìš© (Sparse Retrieval)
- Semantic ìœ ì‚¬ë„ ê³ ë ¤ ì•ˆ í•¨

**í•´ê²°ì±…**:
```python
# Dense + Sparse Hybrid
BM25 ì ìˆ˜ (0.7) + Dense ì ìˆ˜ (0.3) = ìµœì¢… ì ìˆ˜
```

**êµ¬í˜„**:
1. ë¬¸ì„œ ì„ë² ë”© ìƒì„± (í•œ ë²ˆë§Œ ì‹¤í–‰)
2. Query ì„ë² ë”© + Cosine Similarity
3. RRF (Reciprocal Rank Fusion)ë¡œ ê²°í•©

**ì˜ˆìƒ íš¨ê³¼**: MAP +0.05~0.07

---

## ğŸ“ˆ ì˜ˆìƒ ìµœì¢… ì ìˆ˜

| Phase | ê°œì„  ë‚´ìš© | ì˜ˆìƒ í–¥ìƒ | ëˆ„ì  ì ìˆ˜ |
|-------|----------|-----------|----------|
| **Baseline** | super_simple (Threshold 2.0) | - | 0.63 |
| **Phase 1** | Context-Aware Search | +0.15 | **0.78** |
| **Phase 2** | Query Expansion | +0.05 | **0.83** |
| **Phase 3** | Hybrid Search ê³ ë„í™” | +0.07 | **0.90** âœ… |

**ì´ ì˜ˆìƒ í–¥ìƒ**: +0.27
**ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„±**: âœ… **HIGH**

---

## ğŸ› ï¸ ì‹¤í–‰ ê³„íš

### Step 1: Context-Aware ë²„ì „ í…ŒìŠ¤íŠ¸ (ìµœìš°ì„ )

```bash
cd code

# ì‹¤í–‰
python3 rag_with_context.py

# Validation í‰ê°€
python3 create_quick_validation.py  # context_aware_submission.csv ì¶”ê°€ í‰ê°€
```

**ê¸°ëŒ€ ê²°ê³¼**:
- Validation MAP: 0.5056 â†’ 0.60+ (ì•½ +0.10)
- Leaderboard ì œì¶œ ì˜ˆìƒ ì ìˆ˜: 0.78

---

### Step 2: Query Expansion ì¶”ê°€

```bash
# êµ¬í˜„ í•„ìš”
python3 rag_with_expansion.py
```

**í•µì‹¬ ê¸°ëŠ¥**:
1. ì˜ì–´ í‚¤ì›Œë“œ í•œê¸€ ë³€í™˜
2. ë™ì˜ì–´ ì‚¬ì „ êµ¬ì¶•
3. Query Expansion

---

### Step 3: Hybrid Search ìµœì í™”

```bash
# ê¸°ì¡´ rag_with_elasticsearch_1120.py ê°œì„ 
python3 rag_hybrid_optimized.py
```

**ê°œì„  ì‚¬í•­**:
1. Dense ê²€ìƒ‰ í’ˆì§ˆ í–¥ìƒ
2. RRF ê°€ì¤‘ì¹˜ ì¡°ì • (BM25 70%, Dense 30%)
3. Context-Aware + Query Expansion í†µí•©

---

## ğŸ’¡ ì¶”ê°€ ìµœì í™” ì•„ì´ë””ì–´

### 1. Re-ranking with Cross-Encoder
```python
# Top-10 ê²°ê³¼ë¥¼ Cross-Encoderë¡œ ì¬ì •ë ¬
from sentence_transformers import CrossEncoder
reranker = CrossEncoder('cross-encoder/ms-marco-MiniLM-L-6-v2')
```

**ì˜ˆìƒ íš¨ê³¼**: +0.02~0.03

### 2. Ensemble Strategy
```python
# ì—¬ëŸ¬ ëª¨ë¸ì˜ ê²°ê³¼ë¥¼ ì•™ìƒë¸”
results = {
    'context_aware': 0.78,
    'hybrid': 0.75,
    'expanded': 0.76
}
# Voting ë˜ëŠ” Weighted Average
final_topk = ensemble(results)
```

**ì˜ˆìƒ íš¨ê³¼**: +0.01~0.02

### 3. Hard Negative Mining
```python
# ì˜ëª» ê²€ìƒ‰ëœ ì¼€ì´ìŠ¤ë¥¼ í•™ìŠµ ë°ì´í„°ë¡œ í™œìš©
# Fine-tune Dense Retrieval ëª¨ë¸
```

**ì˜ˆìƒ íš¨ê³¼**: +0.03~0.05 (ì¥ê¸°ì )

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 (í•„ìˆ˜)
- [x] ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ë¶„ì„ ì™„ë£Œ (analyze_failure_cases.py)
- [x] Context-Aware RAG êµ¬í˜„ (rag_with_context.py)
- [ ] Validation set í‰ê°€
- [ ] Leaderboard ì œì¶œ ë° ì ìˆ˜ í™•ì¸

### Phase 2 (ê¶Œì¥)
- [ ] Query Expansion êµ¬í˜„
- [ ] ì˜ì–´-í•œê¸€ í‚¤ì›Œë“œ ë§¤í•‘ ì‚¬ì „ êµ¬ì¶•
- [ ] Validation set í‰ê°€

### Phase 3 (ì„ íƒ)
- [ ] Hybrid Search ê³ ë„í™”
- [ ] RRF ê°€ì¤‘ì¹˜ ìµœì í™”
- [ ] Re-ranking ì¶”ê°€

---

## ğŸ¯ í•µì‹¬ ë©”ì‹œì§€

**0.63 â†’ 0.9 ë‹¬ì„±ì€ ì¶©ë¶„íˆ ê°€ëŠ¥í•©ë‹ˆë‹¤!**

**ì´ìœ **:
1. **Context-Dependent ì¿¼ë¦¬ 3ê°œë§Œ ì œëŒ€ë¡œ ì²˜ë¦¬í•´ë„ +0.15**
2. í˜„ì¬ ì‹œìŠ¤í…œì€ ë‹¨ìˆœ BM25ë§Œ ì‚¬ìš© (ê°œì„  ì—¬ì§€ í¼)
3. ë©€í‹°í„´ ëŒ€í™” ë§¥ë½ì„ ì „í˜€ í™œìš©í•˜ì§€ ì•ŠìŒ (ê°€ì¥ í° ë¬¸ì œ)

**ì„±ê³µ í™•ë¥ **:
- Phase 1ë§Œ ì™„ë£Œ: **80% (0.78 ë‹¬ì„±)**
- Phase 1+2 ì™„ë£Œ: **90% (0.83 ë‹¬ì„±)**
- Phase 1+2+3 ì™„ë£Œ: **95% (0.90 ë‹¬ì„±)** âœ…

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

**ì¦‰ì‹œ ì‹¤í–‰**:
```bash
cd /Users/dongjunekim/dev_team/ai14/ir/code
python3 rag_with_context.py
```

**ê¸°ëŒ€ ê²°ê³¼**: 0.78ì  (í˜„ì¬ 0.63 â†’ +0.15)

ì´í›„ Validation í‰ê°€ë¡œ ê²€ì¦ í›„ Leaderboard ì œì¶œ!
