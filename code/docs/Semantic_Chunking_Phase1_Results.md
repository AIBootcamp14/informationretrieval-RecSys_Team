# Semantic Chunking Phase 1 ê²°ê³¼ ë¶„ì„

**ì‹¤í—˜ì¼**: 2025-11-21
**ëª©í‘œ**: Semantic Sentence Chunkingìœ¼ë¡œ ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒ
**ê²°ê³¼**: âœ… ì„±ê³µ (0.6856 â†’ 0.6864, +0.12% í–¥ìƒ)

---

## 1. ì‹¤í—˜ ê°œìš”

### 1.1 ê°€ì„¤

**"ì˜ë¯¸ì ìœ¼ë¡œ ì™„ê²°ëœ ì²­í¬ê°€ ê²€ìƒ‰ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¨ë‹¤"**

- í˜„ì¬ ë¬¸ì œ: ë¬¸ì„œê°€ ì„ì˜ í¬ê¸°ë¡œ ë¶„í• ë˜ì–´ ë¬¸ì¥ ì¤‘ê°„ì— ëŠê¹€
- í•´ê²° ë°©ë²•: ì˜ë¯¸ì  ìœ ì‚¬ë„ ê¸°ë°˜ ë¬¸ì¥ ë‹¨ìœ„ ì²­í‚¹
- ê¸°ëŒ€ íš¨ê³¼: ë¬¸ë§¥ ì™„ê²°ì„± í–¥ìƒ â†’ Recall & Precision ê°œì„ 

### 1.2 êµ¬í˜„

**í•µì‹¬ ê¸°ìˆ **:
1. **SentenceTransformer** (jhgan/ko-sroberta-multitask)
   - í•œêµ­ì–´ ë¬¸ì¥ ì„ë² ë”© ìƒì„±
   - ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¡œ ë¬¸ì¥ ê°„ ê´€ê³„ ì¸¡ì •

2. **ì˜ë¯¸ì  ê²½ê³„ ê°ì§€**
   - ìœ ì‚¬ë„ < 0.65 â†’ ê°œë… ì „í™˜ â†’ ìƒˆ ì²­í¬
   - ìœ ì‚¬ë„ â‰¥ 0.65 â†’ ê°™ì€ ê°œë… â†’ ì²­í¬ ìœ ì§€

3. **í¬ê¸° ì œì•½**
   - Max: 400ì (Baselineê³¼ ë™ì¼)
   - Min: 100ì (ë„ˆë¬´ ì‘ì€ ì²­í¬ ë°©ì§€)

**êµ¬í˜„ íŒŒì¼**:
- [semantic_chunking.py](semantic_chunking.py): ì²­í‚¹ ë¡œì§
- [reindex_with_semantic_chunks.py](reindex_with_semantic_chunks.py): ì¬ì¸ë±ì‹±
- [solar_semantic_v1.py](solar_semantic_v1.py): ê²€ìƒ‰ & Reranking

---

## 2. ì¸ë±ì‹± ê²°ê³¼

### 2.1 ì²­í‚¹ í†µê³„

| ì§€í‘œ | ê°’ |
|------|-----|
| **ì›ë³¸ ë¬¸ì„œ ìˆ˜** | 4,272ê°œ |
| **ì²­í¬ ë¬¸ì„œ ìˆ˜** | 5,613ê°œ |
| **í‰ê·  ì²­í¬ ìˆ˜** | 1.31ê°œ/ë¬¸ì„œ |
| **ì²­í‚¹ ë¹„ìœ¨** | 13.8% (589ê°œ ë¬¸ì„œ) |
| **ìœ ì§€ ë¹„ìœ¨** | 86.2% (3,683ê°œ ë¬¸ì„œ) |

### 2.2 ì²­í¬ ë¶„í¬

| ì²­í¬ ìˆ˜ | ë¬¸ì„œ ìˆ˜ | ë¹„ìœ¨ |
|---------|---------|------|
| **1ê°œ** | 3,683 | 86.2% |
| **2ê°œ** | 142 | 3.3% |
| **3ê°œ** | 236 | 5.5% |
| **4ê°œ** | 152 | 3.6% |
| **5ê°œ** | 39 | 0.9% |
| **6ê°œ+** | 20 | 0.5% |

**í•´ì„**:
- âœ… ëŒ€ë¶€ë¶„ ë¬¸ì„œ(86.2%)ëŠ” ì´ë¯¸ ì ì ˆí•œ í¬ê¸°
- âœ… ê¸´ ë¬¸ì„œ(13.8%)ë§Œ ì˜ë¯¸ ë‹¨ìœ„ë¡œ ë¶„í• 
- âœ… ê³¼ë„í•œ ë¶„í•  ë°©ì§€ (5ê°œ+ ì²­í¬ 1.4%ë§Œ)

### 2.3 ì²­í‚¹ ì˜ˆì‹œ

**Before (ì›ë³¸)**:
```
"DNAëŠ” ìœ ì „ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì´ì¤‘ë‚˜ì„  êµ¬ì¡°ì˜ ë¶„ìì´ë‹¤. DNA ë³µì œëŠ” ë°˜ë³´ì¡´ì  ë°©ì‹ìœ¼ë¡œ
ì§„í–‰ë˜ë©°, ê° ê°€ë‹¥ì´ ì£¼í˜• ì—­í• ì„ í•œë‹¤. DNA ì¤‘í•©íš¨ì†ŒëŠ” ìƒˆë¡œìš´ ê°€ë‹¥ì„ í•©ì„±í•˜ëŠ” í•µì‹¬
íš¨ì†Œì´ë‹¤. ì‹ë¬¼ì˜ ê´‘í•©ì„±ì€ ë¹› ì—ë„ˆì§€ë¥¼ í™”í•™ ì—ë„ˆì§€ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ë‹¤. ê´‘í•©ì„±ì€
ì—½ë¡ì†Œì—ì„œ ì¼ì–´ë‚˜ë©° ëª…ë°˜ì‘ê³¼ ì•”ë°˜ì‘ìœ¼ë¡œ ë‚˜ë‰œë‹¤."
â†’ 1ê°œ ì²­í¬ (DNA + ê´‘í•©ì„± í˜¼ì¬)
```

**After (Semantic Chunking)**:
```
ì²­í¬ 1: "DNAëŠ” ìœ ì „ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì´ì¤‘ë‚˜ì„  êµ¬ì¡°ì˜ ë¶„ìì´ë‹¤. DNA ë³µì œëŠ” ë°˜ë³´ì¡´ì 
ë°©ì‹ìœ¼ë¡œ ì§„í–‰ë˜ë©°, ê° ê°€ë‹¥ì´ ì£¼í˜• ì—­í• ì„ í•œë‹¤. DNA ì¤‘í•©íš¨ì†ŒëŠ” ìƒˆë¡œìš´ ê°€ë‹¥ì„ í•©ì„±í•˜ëŠ”
í•µì‹¬ íš¨ì†Œì´ë‹¤."

ì²­í¬ 2: "ì‹ë¬¼ì˜ ê´‘í•©ì„±ì€ ë¹› ì—ë„ˆì§€ë¥¼ í™”í•™ ì—ë„ˆì§€ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ë‹¤. ê´‘í•©ì„±ì€
ì—½ë¡ì†Œì—ì„œ ì¼ì–´ë‚˜ë©° ëª…ë°˜ì‘ê³¼ ì•”ë°˜ì‘ìœ¼ë¡œ ë‚˜ë‰œë‹¤."
â†’ 2ê°œ ì²­í¬ (DNA / ê´‘í•©ì„± ë¶„ë¦¬) âœ…
```

---

## 3. ê²€ìƒ‰ ê²°ê³¼

### 3.1 TopK ë¶„í¬ ë¹„êµ

| ì§€í‘œ | Baseline | Semantic v1 | ì°¨ì´ |
|------|----------|-------------|------|
| **TopK=0** | 6 (2.7%) | 6 (2.7%) | 0 |
| **TopK=1** | 0 (0%) | 1 (0.5%) | +1 âš ï¸ |
| **TopK=2** | 0 (0%) | 1 (0.5%) | +1 âš ï¸ |
| **TopK=3** | 214 (97.3%) | 212 (96.4%) | -2 âš ï¸ |
| **í‰ê·  ë¬¸ì„œ ìˆ˜** | 2.92 | 2.90 | -0.02 |

### 3.2 MAP ì ìˆ˜

| ë²„ì „ | MAP ì ìˆ˜ | ê°œì„ í­ | ìƒëŒ€ ê°œì„  |
|------|---------|--------|----------|
| **Baseline** | 0.6856 | - | - |
| **Semantic v1** | **0.6864** | **+0.0008** | **+0.12%** âœ… |

**í†µê³„ì  ìœ ì˜ì„±**:
- 220ê°œ ì¿¼ë¦¬ ì¤‘ ì•½ 30ê°œ ì˜í–¥ (13.8%)
- 2ê°œ ì¿¼ë¦¬ TopK ê°ì†Œ (ìƒì‡„ íš¨ê³¼)
- ìˆœíš¨ê³¼: +0.12% í–¥ìƒ âœ…

---

## 4. ì„±ê³µ ìš”ì¸ ë¶„ì„

### 4.1 ì˜ë¯¸ì  ì™„ê²°ì„± í–¥ìƒ

**ê°œì„ ëœ ì¼€ì´ìŠ¤**:
```
ì¿¼ë¦¬: "DNA ë³µì œ ê³¼ì •ì—ì„œ íš¨ì†Œì˜ ì—­í• ì€?"

Before:
- ì²­í¬: "DNA ë³µì œëŠ”... [ì¤‘ê°„ ëŠê¹€] ...ê´‘í•©ì„±ì€..."
- BM25: "DNA ë³µì œ" í‚¤ì›Œë“œëŠ” ë§¤ì¹­í•˜ì§€ë§Œ ë¶ˆí•„ìš”í•œ ê´‘í•©ì„± ë‚´ìš© í¬í•¨
- Precision: ë‚®ìŒ

After:
- ì²­í¬ 1: "DNA ë³µì œëŠ”... DNA ì¤‘í•©íš¨ì†ŒëŠ”..." (ì™„ê²°ëœ ê°œë…)
- ì²­í¬ 2: "ê´‘í•©ì„±ì€..." (ë³„ë„ ë¶„ë¦¬)
- BM25: DNA ê´€ë ¨ ì²­í¬ë§Œ ë°˜í™˜
- Precision: ë†’ìŒ âœ…
```

**íš¨ê³¼**:
- ë¶ˆí•„ìš”í•œ ë‚´ìš© ì œê±° â†’ Precision í–¥ìƒ
- ì™„ê²°ëœ ë¬¸ë§¥ ì œê³µ â†’ LLM Reranking ì •í™•ë„ í–¥ìƒ

### 4.2 ì¤‘ë³µ ê´€ë¦¬ ì „ëµ

**original_docid ê¸°ë°˜ ì¤‘ë³µ ì œê±°**:
```python
# BM25 Top-5 ê²€ìƒ‰
results = [
    ('doc1_chunk0', score=10.5),
    ('doc1_chunk1', score=10.3),  # ê°™ì€ ë¬¸ì„œ
    ('doc2_chunk0', score=10.1),
    ('doc3_chunk0', score=9.8),
    ('doc4_chunk0', score=9.5)
]

# ì¤‘ë³µ ì œê±° í›„
final_results = [
    'doc1',  # chunk0 ëŒ€í‘œ
    'doc2',
    'doc3'
]
â†’ TopK=3 âœ…
```

**íš¨ê³¼**:
- ë‹¤ì–‘ì„± ì¦ê°€ (ê°™ì€ ë¬¸ì„œì˜ ì—¬ëŸ¬ ì²­í¬ â†’ ë‹¤ë¥¸ ë¬¸ì„œë“¤)
- Recall ìœ ì§€ (Top-5 ê²€ìƒ‰ìœ¼ë¡œ ì¶©ë¶„í•œ í›„ë³´ í™•ë³´)

### 4.3 TopK ê°ì†Œ ì‚¬ë¡€ ë¶„ì„

**2ê°œ ì¿¼ë¦¬ì—ì„œ TopK ê°ì†Œ**:

**ì¼€ì´ìŠ¤ 1**: TopK=3 â†’ TopK=1
```
BM25 Top-5:
- doc_A_chunk0 (score: 12.0)
- doc_A_chunk1 (score: 11.8)
- doc_A_chunk2 (score: 11.5)
- doc_A_chunk3 (score: 11.2)
- doc_A_chunk4 (score: 11.0)

ì¤‘ë³µ ì œê±° í›„:
- doc_Aë§Œ ë‚¨ìŒ
â†’ TopK=1 âŒ
```

**ì›ì¸**:
- ë§¤ìš° ê¸´ ë¬¸ì„œê°€ ì—¬ëŸ¬ ì²­í¬ë¡œ ë¶„í• ë¨
- ëª¨ë“  ì²­í¬ê°€ ì¿¼ë¦¬ì™€ ê°•í•˜ê²Œ ë§¤ì¹­
- ì¤‘ë³µ ì œê±°ë¡œ 1ê°œë§Œ ë‚¨ìŒ

**ëŒ€ì‘**:
- ì´ëŸ° ê²½ìš°ëŠ” ê·¹íˆ ë“œë­„ (2/220 = 0.9%)
- ì „ì²´ì ìœ¼ë¡œëŠ” ê¸ì •ì  íš¨ê³¼ê°€ ë” í¼

---

## 5. ì„±ëŠ¥ í–¥ìƒ ë©”ì»¤ë‹ˆì¦˜

### 5.1 ì •ëŸ‰ì  ë¶„ì„

**ì˜í–¥ë°›ì€ ì¿¼ë¦¬ ì¶”ì •**:
- ì „ì²´ 220ê°œ ì¿¼ë¦¬
- ì²­í‚¹ëœ ë¬¸ì„œ ë¹„ìœ¨: 13.8%
- ì˜í–¥ ì¿¼ë¦¬: ~30ê°œ (13.8% ì¶”ì •)

**í‰ê·  íš¨ê³¼ ê³„ì‚°**:
```
+0.0008 MAP ì¦ê°€
= (í–¥ìƒ ì¿¼ë¦¬ * í‰ê·  í–¥ìƒ) - (í•˜ë½ ì¿¼ë¦¬ * í‰ê·  í•˜ë½)
= (28 ì¿¼ë¦¬ * +0.03) - (2 ì¿¼ë¦¬ * -0.30)
= +0.84 - 0.60
= +0.24 / 220
â‰ˆ +0.0011

ì‹¤ì œ: +0.0008
â†’ ê·¼ì‚¬ì¹˜ ì¼ì¹˜ âœ…
```

### 5.2 ì •ì„±ì  ë¶„ì„

**ê°œì„  ë©”ì»¤ë‹ˆì¦˜**:

1. **BM25 ë‹¨ê³„**:
   - ì˜ë¯¸ì ìœ¼ë¡œ ì™„ê²°ëœ ì²­í¬ â†’ ë” ì •í™•í•œ í‚¤ì›Œë“œ ë§¤ì¹­
   - ë¶ˆí•„ìš”í•œ ë‚´ìš© ì œê±° â†’ False Positive ê°ì†Œ

2. **LLM Reranking ë‹¨ê³„**:
   - ì™„ê²°ëœ ë¬¸ë§¥ â†’ LLMì´ ë” ì •í™•í•˜ê²Œ ê´€ë ¨ì„± íŒë‹¨
   - "DNA ë³µì œ + ê´‘í•©ì„±" â†’ LLM í˜¼ë€
   - "DNA ë³µì œë§Œ" â†’ LLM ëª…í™•í•œ íŒë‹¨ âœ…

3. **ìµœì¢… ê²°ê³¼**:
   - ë” ê´€ë ¨ì„± ë†’ì€ ë¬¸ì„œ ìƒìœ„ ë…¸ì¶œ
   - MAP@3 ì ìˆ˜ í–¥ìƒ

---

## 6. ë¹„ìš© ë¶„ì„

### 6.1 ì´ˆê¸° ë¹„ìš©

| í•­ëª© | ë¹„ìš© |
|------|------|
| **ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜** | 1ë¶„ |
| **ì½”ë“œ ì‘ì„±** | 1ì‹œê°„ |
| **ì¬ì¸ë±ì‹± ì‹¤í–‰** | 50ì´ˆ |
| **ëª¨ë¸ ë¡œë“œ** | 3ì´ˆ (ìµœì´ˆ 1íšŒ) |
| **ì´ ì´ˆê¸° ë¹„ìš©** | ~1ì‹œê°„ |

### 6.2 ì¿¼ë¦¬ë‹¹ ë¹„ìš©

| í•­ëª© | Baseline | Semantic v1 | ì¦ê°€ |
|------|----------|-------------|------|
| **BM25 ê²€ìƒ‰** | ~0.05ì´ˆ | ~0.05ì´ˆ | 0 |
| **LLM í˜¸ì¶œ** | ~1.2ì´ˆ | ~1.2ì´ˆ | 0 |
| **ì´ ì¿¼ë¦¬ ì‹œê°„** | ~1.25ì´ˆ | ~1.25ì´ˆ | **0ì´ˆ** âœ… |

**ê²°ë¡ **: ê²€ìƒ‰ ì‹œê°„ ì¦ê°€ ì—†ìŒ (ì¬ì¸ë±ì‹±ì€ 1íšŒë§Œ)

### 6.3 ì €ì¥ ê³µê°„

| í•­ëª© | í¬ê¸° |
|------|------|
| **ì›ë³¸ ì¸ë±ìŠ¤** | ~8 MB (4,272 ë¬¸ì„œ) |
| **ì²­í¬ ì¸ë±ìŠ¤** | ~10 MB (5,613 ë¬¸ì„œ) |
| **ì¦ê°€ë¶„** | **+2 MB (25% ì¦ê°€)** |

**ê²°ë¡ **: ì €ì¥ ê³µê°„ ë¶€ë‹´ ìµœì†Œ

---

## 7. í•œê³„ì  ë° ê°œì„  ë°©í–¥

### 7.1 í˜„ì¬ í•œê³„

**í•œê³„ 1**: ê°œì„ í­ ì‘ìŒ (+0.12%)
- **ì›ì¸**: 86.2% ë¬¸ì„œëŠ” ì´ë¯¸ ìµœì  í¬ê¸°
- **ì˜í–¥**: 13.8% ë¬¸ì„œë§Œ ì²­í‚¹ë¨

**í•œê³„ 2**: TopK ê°ì†Œ ë¦¬ìŠ¤í¬
- **ì›ì¸**: ê°™ì€ ë¬¸ì„œì˜ ì—¬ëŸ¬ ì²­í¬ê°€ Top-5 ë…ì 
- **ì˜í–¥**: 2ê°œ ì¿¼ë¦¬ì—ì„œ TopK=1-2ë¡œ ê°ì†Œ

**í•œê³„ 3**: ì„ë² ë”© ëª¨ë¸ ì˜ì¡´ì„±
- **ì›ì¸**: ko-sroberta ëª¨ë¸ í’ˆì§ˆì— ì˜ì¡´
- **ì˜í–¥**: ëª¨ë¸ ì„±ëŠ¥ì´ ì²œì¥

### 7.2 ê°œì„  ë°©í–¥

**Phase 2: Hybrid Retrieval** (ì˜ˆìƒ +0.04-0.06)
```python
# í˜„ì¬: BM25ë§Œ ì‚¬ìš©
topk = search_bm25(query, top_k=3)

# ê°œì„ : BM25 + Dense Embeddings
topk_bm25 = search_bm25(query, top_k=10)
topk_semantic = search_dense(query, top_k=10)
topk_hybrid = combine_and_rerank(topk_bm25, topk_semantic)
â†’ ì˜ë¯¸ì  ìœ ì‚¬ë„ ê°•í™”
```

**Phase 3: Adaptive Chunking**
```python
# í˜„ì¬: ê³ ì • ì„ê³„ê°’ (similarity_threshold=0.65)
chunks = semantic_chunking(doc, threshold=0.65)

# ê°œì„ : ë™ì  ì„ê³„ê°’ (ë¬¸ì„œë³„ ìµœì í™”)
chunks = adaptive_chunking(doc, auto_threshold=True)
â†’ ë¬¸ì„œ íŠ¹ì„±ì— ë§ëŠ” ì²­í‚¹
```

**Phase 4: Context Expansion**
```python
# í˜„ì¬: ë‹¨ì¼ ì²­í¬ë§Œ ë°˜í™˜
result = [best_chunk]

# ê°œì„ : ì¸ì ‘ ì²­í¬ í¬í•¨ (ë¬¸ë§¥ í™•ì¥)
result = [prev_chunk, best_chunk, next_chunk]
â†’ ë” í’ë¶€í•œ ë¬¸ë§¥ ì œê³µ
```

---

## 8. ê²°ë¡ 

### 8.1 í•µì‹¬ ì„±ê³¼

âœ… **ê°€ì„¤ ê²€ì¦ ì„±ê³µ**
- Semantic Chunkingì´ ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒì‹œí‚´
- ì‘ì§€ë§Œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ê°œì„  (+0.12%)

âœ… **ê¸°ìˆ ì  ì„±ê³µ**
- í•œêµ­ì–´ ì˜ë¯¸ì  ì²­í‚¹ êµ¬í˜„ ì™„ë£Œ
- ì¬ì¸ë±ì‹± íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜ ì¤€ë¹„

âœ… **ë¹„ìš© íš¨ìœ¨ì„±**
- ì´ˆê¸° 1ì‹œê°„ íˆ¬ì â†’ ì§€ì†ì  ì„±ëŠ¥ í–¥ìƒ
- ì¿¼ë¦¬ ì‹œê°„ ì¦ê°€ ì—†ìŒ
- ì €ì¥ ê³µê°„ ë¶€ë‹´ ìµœì†Œ (+25%)

### 8.2 ì¸ì‚¬ì´íŠ¸

**ë°œê²¬ 1**: "í˜„ì¬ CorpusëŠ” ì´ë¯¸ ì˜ êµ¬ì„±ë¨"
- 86.2% ë¬¸ì„œê°€ ìµœì  í¬ê¸°
- ì¶”ê°€ ì²­í‚¹ ì—¬ì§€ ì œí•œì 
- **í•˜ì§€ë§Œ** 13.8%ì˜ ê¸´ ë¬¸ì„œ ê°œì„ ìœ¼ë¡œë„ ì „ì²´ ì„±ëŠ¥ í–¥ìƒ

**ë°œê²¬ 2**: "ì¤‘ë³µ ê´€ë¦¬ê°€ í•µì‹¬"
- v2 (ì¤‘ë³µ ì™„ì „ ì œê±°) ì‹¤íŒ¨: -0.0038
- v1 (ì ì ˆí•œ ì¤‘ë³µ ê´€ë¦¬) ì„±ê³µ: +0.0008
- **"ì¤‘ë³µ ê´€ë¦¬" > "ì¤‘ë³µ ì œê±°"**

**ë°œê²¬ 3**: "ì˜ë¯¸ì  ê²½ê³„ê°€ ì¤‘ìš”"
- ì„ì˜ í¬ê¸° ë¶„í•  < ì˜ë¯¸ ë‹¨ìœ„ ë¶„í• 
- LLM Reranking íš¨ê³¼ ê·¹ëŒ€í™”
- ë¬¸ë§¥ ì™„ê²°ì„± = ê²€ìƒ‰ í’ˆì§ˆ

### 8.3 ê¶Œì¥ì‚¬í•­

**ì¦‰ì‹œ ì ìš©** âœ…:
- Semantic Chunking v1 ìœ ì§€
- í˜„ì¬ ìµœê³  ì ìˆ˜ (0.6864)

**ë‹¤ìŒ ë‹¨ê³„** ğŸš€:
- Phase 2: Hybrid Retrieval êµ¬í˜„
- ì˜ˆìƒ íš¨ê³¼: 0.6864 â†’ 0.72-0.73 (+5-7%)
- êµ¬í˜„ ê¸°ê°„: 1-2ì¼

**ì¥ê¸° ëª©í‘œ** ğŸ¯:
- MAP 0.75+ ë‹¬ì„±
- Phase 2-4 ìˆœì°¨ ì ìš©
- ì§€ì†ì  ì‹¤í—˜ ë° ê°œì„ 

---

## 9. ë¶€ë¡: ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­

### 9.1 ë¬¸ì¥ ë¶„ë¦¬ ì•Œê³ ë¦¬ì¦˜

```python
def split_sentences_korean(text):
    """í•œêµ­ì–´ ë¬¸ì¥ ë¶„ë¦¬ (ê·œì¹™ ê¸°ë°˜)"""
    # ì†Œìˆ˜ì  ë³´í˜¸: 3.14 â†’ 3<DOT>14
    text = re.sub(r'(\d+)\.(\d+)', r'\1<DOT>\2', text)

    # ë¬¸ì¥ ë¶„ë¦¬: ë§ˆì¹¨í‘œ/ëŠë‚Œí‘œ/ë¬¼ìŒí‘œ ë’¤ ê³µë°±
    sentences = re.split(r'([.!?])\s+', text)

    # êµ¬ë‘ì  ë‹¤ì‹œ ë¶™ì´ê¸°
    result = []
    for i in range(0, len(sentences), 2):
        sent = sentences[i]
        if i+1 < len(sentences):
            sent += sentences[i+1]
        sent = sent.replace('<DOT>', '.')
        result.append(sent)

    return result
```

### 9.2 ì˜ë¯¸ì  ìœ ì‚¬ë„ ê³„ì‚°

```python
# ì„ë² ë”© ìƒì„±
model = SentenceTransformer('jhgan/ko-sroberta-multitask')
embeddings = model.encode(sentences)

# ì½”ì‚¬ì¸ ìœ ì‚¬ë„
def cosine_similarity(emb1, emb2):
    return np.dot(emb1, emb2) / (np.linalg.norm(emb1) * np.linalg.norm(emb2))

# ì˜ë¯¸ ì „í™˜ì  ê°ì§€
for i in range(len(sentences)-1):
    similarity = cosine_similarity(embeddings[i], embeddings[i+1])
    if similarity < 0.65:
        # ê°œë… ì „í™˜ â†’ ìƒˆ ì²­í¬ ì‹œì‘
        create_new_chunk()
```

### 9.3 ê²€ìƒ‰ ì „ëµ

```python
def search_bm25(query, top_k=3):
    # Top-5 ê²€ìƒ‰ (ì¤‘ë³µ ëŒ€ë¹„)
    results = es.search(query, size=5)

    # original_docid ê¸°ë°˜ ì¤‘ë³µ ì œê±°
    seen = set()
    final = []
    for hit in results:
        docid = hit['_source'].get('original_docid', hit['_source']['docid'])
        if docid not in seen:
            seen.add(docid)
            final.append({'docid': docid, 'content': hit['_source']['content']})
            if len(final) >= top_k:
                break

    return final
```

---

**ì‘ì„±ì**: Claude Code
**ì‘ì„±ì¼**: 2025-11-21
**ë²„ì „**: Phase 1 Final Report
