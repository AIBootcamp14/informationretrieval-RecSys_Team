# OpenAI API 사용량 및 비용 분석

## 실제 사용 현황

### 테스트 정보
- **모델**: GPT-4o (최신)
- **처리 완료**: 25개 쿼리
- **할당량 초과 시점**: 26번째 쿼리
- **초기 크레딧**: $5.00

---

## 비용 계산

### 1. GPT-4o 가격 정책 (2024년 기준)

| 항목 | 입력 토큰 가격 | 출력 토큰 가격 |
|------|---------------|---------------|
| **GPT-4o** | $2.50 / 1M tokens | $10.00 / 1M tokens |
| **GPT-4o-mini** | $0.150 / 1M tokens | $0.600 / 1M tokens |

**참고**: GPT-4o는 GPT-4o-mini보다 **16-17배 비쌉니다.**

---

### 2. 토큰 사용량 추정

#### Query Rewriting (각 쿼리당)
```
입력 토큰:
- 시스템 프롬프트: ~200 tokens
- 사용자 질문: ~50-100 tokens
→ 평균: 300 tokens

출력 토큰:
- 개선된 쿼리: ~50 tokens
→ 평균: 50 tokens
```

#### Reranking (각 쿼리당)
```
입력 토큰:
- 시스템 프롬프트: ~150 tokens
- 질문: ~50 tokens
- 문서 3개 (각 600자): ~900 tokens
→ 평균: 1,100 tokens

출력 토큰:
- 순위 결과 (예: "2,1,3"): ~10 tokens
→ 평균: 10 tokens
```

#### 쿼리당 총 토큰
```
입력: 300 + 1,100 = 1,400 tokens/query
출력: 50 + 10 = 60 tokens/query
```

---

### 3. 25개 쿼리 비용 계산

#### 총 토큰 사용량
```
입력 토큰: 1,400 × 25 = 35,000 tokens = 0.035M tokens
출력 토큰: 60 × 25 = 1,500 tokens = 0.0015M tokens
```

#### 비용 계산
```
입력 비용: 0.035M × $2.50 = $0.0875
출력 비용: 0.0015M × $10.00 = $0.015
─────────────────────────────────────
총 비용: $0.1025 ≈ $0.10
```

---

### 4. $5 크레딧으로 가능한 최대 쿼리 수

#### 방법 1: 역계산
```
$5.00 ÷ $0.10 (25개) = 50배
50배 × 25개 = 1,250개 쿼리
```

#### 방법 2: 쿼리당 비용
```
쿼리당 비용 = $0.10 ÷ 25 = $0.004/query
최대 쿼리 수 = $5.00 ÷ $0.004 = 1,250 queries
```

**결론**: $5 크레딧으로 **약 1,250개 쿼리** 처리 가능

---

### 5. 왜 25개에서 멈췄을까?

#### 가능한 원인

**1. 기존 사용량 존재**
- 이미 $4.90 사용된 상태
- 남은 크레딧: $0.10
- → 25개 처리 후 소진

**2. Rate Limit (속도 제한)**
- 무료/스타터 플랜의 경우 RPM(분당 요청) 제한
- 3-5 RPM 제한 가능
- → 할당량 오류는 아니지만 동일 메시지 표시

**3. 실제로 더 많이 사용**
- 실패/재시도 요청도 비용 청구
- 프롬프트 길이가 예상보다 김
- → 실제 토큰 수가 더 많았을 가능성

---

## 비용 비교 분석

### 1. 220개 쿼리 전체 처리 비용

| API | 모델 | 쿼리당 비용 | 220개 총 비용 |
|-----|------|------------|-------------|
| **Solar API** | solar-mini + solar-pro | ~$0.0005 | **$0.11** |
| **OpenAI** | gpt-4o | ~$0.004 | **$0.88** |
| **OpenAI** | gpt-4o-mini | ~$0.0002 | **$0.04** |

**gpt-4o는 Solar보다 약 8배 비쌉니다!**

### 2. 프로덕션 비용 (월 100만 쿼리)

| API | 모델 | 월 예상 비용 |
|-----|------|------------|
| **Solar API** | solar-mini + solar-pro | **$500** |
| **OpenAI** | gpt-4o | **$4,000** |
| **OpenAI** | gpt-4o-mini | **$200** |

---

## 실제 사용 시나리오별 $5 크레딧 활용

### 시나리오 1: GPT-4o (현재 설정)
```
✅ 처리 가능: 1,250 쿼리
⏱️  소요 시간: 약 1.4시간 (4초/쿼리)
💰 효율: $0.004/query
```

### 시나리오 2: GPT-4o-mini로 변경
```
✅ 처리 가능: 25,000 쿼리
⏱️  소요 시간: 약 15시간 (2초/쿼리)
💰 효율: $0.0002/query
```

### 시나리오 3: Solar API 사용
```
✅ 처리 가능: 10,000 쿼리
⏱️  소요 시간: 약 5시간 (2초/쿼리)
💰 효율: $0.0005/query
🎯 추가 장점: 할당량 걱정 없음
```

---

## 권장사항

### 즉시 조치

**1. API 키 확인**
```bash
# OpenAI Dashboard에서 확인
https://platform.openai.com/usage
- 사용량 확인
- 남은 크레딧 확인
- 청구 내역 검토
```

**2. 크레딧 추가 (선택사항)**
- 최소 $10 추가 권장
- Pay-as-you-go 플랜으로 업그레이드 고려

**3. 모델 다운그레이드**
- gpt-4o → gpt-4o-mini
- 비용 17배 절감
- 성능은 약간 낮지만 충분히 사용 가능

### 장기 전략

**비용 최적화 우선순위**:
1. **Solar API 메인 사용** (가장 경제적)
2. gpt-4o-mini (예산 제약 시)
3. gpt-4o (최고 품질 필요 시만)

**하이브리드 접근**:
- 80% 쿼리: Solar API ($0.0005/query)
- 20% 중요 쿼리: GPT-4o ($0.004/query)
- → 평균 비용: $0.001/query

---

## 정확한 비용 확인 방법

### OpenAI Dashboard 확인
```
1. https://platform.openai.com/usage 접속
2. Date Range: 오늘 날짜 선택
3. 실제 사용 토큰 수 확인
4. 정확한 비용 확인
```

### 예상 사용량 (오늘 테스트)
```
예상 입력 토큰: 35,000 tokens
예상 출력 토큰: 1,500 tokens
예상 비용: $0.10

실제 값은 Dashboard에서 확인 필요
```

---

## 결론

### 현재 상황 요약
✅ **25개 쿼리 처리 완료**
💰 **약 $0.10 사용** (또는 기존 사용으로 $4.90 소진)
🚫 **할당량 초과로 중단**

### 비용 효율성
- **Solar API**: 8배 저렴
- **gpt-4o-mini**: 20배 저렴
- **gpt-4o**: 가장 비쌈 but 최고 품질

### 최종 추천
🏆 **Solar API 사용** + 필요 시 OpenAI gpt-4o 병행

---

**분석 작성**: Claude Code
**작성일**: 2025-11-21
